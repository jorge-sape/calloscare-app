<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CallosCare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        #calloscare-app-container { font-family: 'Inter', sans-serif; }
        .calloscare-step { display: none; }
        .calloscare-step.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .progress-bar-fill { transition: width 0.5s ease-in-out; }
        .calloscare-option-card { cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .calloscare-option-card:hover { transform: translateY(-5px); }
        .calloscare-option-card.selected { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4); }
        .calloscare-btn.selected { background-color: #2563eb !important; color: white !important; }
        .calloscare-btn.selected span { color: white !important; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; } .prose li { margin-top: 0.5rem; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 700px; max-height: 90vh; overflow-y: auto; }
        .zoom-modal .modal-content { background: transparent; border: none; padding: 0; max-width: 90vw; max-height: 90vh; }
        .zoom-modal img { width: 100%; height: 100%; object-fit: contain; }
        details[open] summary .arrow-icon { transform: rotate(180deg); }
        .product-link.user-choice { color: #27ae60; font-weight: bold; }
    </style>
</head>
<body>

<div id="calloscare-app-container" class="max-w-4xl mx-auto bg-gray-50 p-4 sm:p-6 rounded-lg shadow-lg">
    <header class="text-center mb-6 bg-blue-600 p-4 rounded-lg shadow-md">
        <h1 id="app-title" class="text-3xl font-bold text-white">CallosCare</h1>
        <p class="text-md text-blue-100">Assistente de Diagnóstico e Tratamento da DOR e dos seus Calos</p>
    </header>
    <div id="progress-bar-container" class="w-full bg-gray-200 rounded-full h-2.5 mb-8 hidden">
        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
    </div>
    <main id="calloscare-main-content"></main>
</div>

<div id="image-zoom-modal" class="modal zoom-modal flex items-center justify-center" onclick="CallosCareApp.closeModal()">
    <div class="modal-content"><img id="zoomed-image" src="" alt="Imagem Ampliada"></div>
</div>
<div id="definition-modal" class="modal">
    <div class="modal-content">
        <span onclick="CallosCareApp.closeModal()" class="float-right text-2xl font-bold cursor-pointer">&times;</span>
        <h2 id="definition-title" class="text-2xl font-bold mb-4"></h2>
        <div id="definition-text" class="text-gray-700 prose"></div>
    </div>
</div>
<div id="product-modal" class="modal">
    <div class="modal-content">
        <span onclick="CallosCareApp.closeModal()" class="float-right text-2xl font-bold cursor-pointer">&times;</span>
        <h2 id="product-title" class="text-2xl font-bold mb-4"></h2>
        <div id="product-list" class="space-y-2"></div>
    </div>
</div>

<script>
// CallosCare App v3.2
const CallosCareApp = {
    API_BASE_URL: 'https://corsproxy.io/?https://calloscare-api.vercel.app/api',
    VERSION: 'v3.2',
    state: { user: null, appConfig: null, currentStep: 'loading', diagnosis: {}, history: null, viewingHistoryItem: null },

    async init() {
        this.render(); this.loadUserFromLocalStorage();
        try { this.state.appConfig = await this.api.getAppConfig(); this.state.currentStep = this.state.user ? 'home' : 'identification';
        } catch (error) { this.state.currentStep = 'error'; }
        this.render();
    },

    loadUserFromLocalStorage() { try { const u = localStorage.getItem('calloscareUser'); if(u) this.state.user = JSON.parse(u); } catch(e){} },
    saveUserToLocalStorage() { localStorage.setItem('calloscareUser', JSON.stringify(this.state.user)); },

    api: {
        async getAppConfig() { const r=await fetch(`${CallosCareApp.API_BASE_URL}/getAppConfig`); if (!r.ok) throw new Error('Network response was not ok'); return r.json(); },
        async saveClientData(d) { const r=await fetch(`${CallosCareApp.API_BASE_URL}/saveClient`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)}); if (!r.ok) throw new Error('Failed to save client data'); return r.json(); },
        async saveDiagnosticData(d) { const r=await fetch(`${CallosCareApp.API_BASE_URL}/saveDiagnostic`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)}); if (!r.ok) throw new Error('Failed to save diagnostic data'); return r.json(); },
        async getHistory(id) { const r=await fetch(`${CallosCareApp.API_BASE_URL}/getHistory?client_id=${id}`); if (!r.ok) throw new Error('Failed to fetch history'); return r.json(); }
    },

    async saveUser() {
        const fn=document.getElementById('user-first-name').value.trim(),ln=document.getElementById('user-last-name').value.trim(),e=document.getElementById('user-email')?.value.trim(),ec=document.getElementById('user-email-confirm')?.value.trim(),p=document.getElementById('user-phone')?.value.trim(),d=document.getElementById('dob-day').value,m=document.getElementById('dob-month').value,y=document.getElementById('dob-year').value,g=document.getElementById('user-gender').value,mc=document.getElementById('marketing-consent').checked;
        const iem = !document.getElementById('email-fields').classList.contains('hidden');
        if(!fn||!ln){alert('Nome e apelido são obrigatórios.');return;}
        if(iem){if(!e){alert('É necessário preencher o Email.');return;}if(e!==ec){alert('Os emails não coincidem.');return;}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){alert('Email inválido.');return;}}else{if(!p){alert('É necessário preencher o Telemóvel.');return;}}
        const dob=(y&&m&&d)?`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`:null;
        const ud={firstName:fn,lastName:ln,email:e||null,phone:p||null,dob,gender:g||null,marketing_consent:mc};
        this.showSpinner('save-client-spinner');
        try { const res = await this.api.saveClientData(ud); this.state.user = {...res.data[0]}; this.saveUserToLocalStorage(); this.goToStep('home');
        } catch (err) { alert(`Erro: ${err.message}`); } finally { this.hideSpinner('save-client-spinner'); }
    },
    
    startDiagnosis() { this.state.diagnosis = { is_diabetic: undefined, locations:[],physicalChanges:[],investigation_inputs:[], suggestedProducts: [], userSelectedProducts: {}}; this.goToStep('step0_triage'); },
    selectOption(key,value,nextFocusId=null){this.state.diagnosis[key]=value;this.render();if(nextFocusId){setTimeout(()=>document.getElementById(nextFocusId)?.focus(),100);}else{setTimeout(()=>document.querySelector('.step-next-btn')?.focus(),100);}},
    toggleMultiOption(key,value,isExclusive=false){let a=this.state.diagnosis[key]||[];if(!Array.isArray(a))a=[];const i=a.indexOf(value);if(isExclusive){a.length=0;a.push(value);document.querySelectorAll(`.${key}-btn`).forEach(b=>{if(b.dataset.value!==value)b.classList.remove('selected');});}else{const n=a.indexOf('nenhum');if(n>-1)a.splice(n,1);if(i>-1){a.splice(i,1);}else{a.push(value);}}this.state.diagnosis[key]=a;this.render();if(a.length===1&&key==='locations'){setTimeout(()=>document.querySelector('.step-next-btn')?.focus(),100);}},
    goToStep(step) { this.state.currentStep = step; window.scrollTo(0,0); this.render(); },
    
    generateAndGoToResults() { this.goToStep('step5_results'); },

    async saveDiagnosis() {
        this.showSpinner('save-diag-spinner');
        const d = this.state.diagnosis;
        const resultsContent = this.generateTreatmentHtml(d, true);
        const payload = { client_id: this.state.user.id, callus_type_name: d.callusType.name, pain_level: d.painLevel, inflammation: d.inflammation, locations: d.locations, foot_type: d.footType, has_deformity: d.hasDeformity, is_diabetic: d.is_diabetic, investigation_inputs: d.investigation_inputs, treatment_protocol_html: JSON.stringify(resultsContent), suggested_products_snapshot: JSON.stringify(d.suggestedProducts) };
        try {
            await this.api.saveDiagnosticData(payload);
            d.isSaved = true;
            this.render();
        } catch (error) { alert(`Erro ao guardar: ${error.message}`);
        } finally { this.hideSpinner('save-diag-spinner'); }
    },

    async viewHistory() {
        this.goToStep('loading');
        try { this.state.history = await this.api.getHistory(this.state.user.id); this.goToStep('history');
        } catch(error) { alert(`Erro: ${error.message}`); this.goToStep('home'); }
    },
    
    startWithoutSaving() { this.state.user = {id:'guest',firstName:'Convidado'}; this.goToStep('home'); },
    goBackToIdentification() { this.state.user = null; localStorage.removeItem('calloscareUser'); this.goToStep('identification'); },
    showSpinner(id){const b=document.getElementById(id)?.parentElement; if(b){b.setAttribute('disabled','true');b.querySelector('i')?.classList.remove('hidden');}},
    hideSpinner(id){const b=document.getElementById(id)?.parentElement; if(b){b.removeAttribute('disabled');b.querySelector('i')?.classList.add('hidden');}},
    showImageZoom(e,url){e.stopPropagation();document.getElementById('zoomed-image').src=url;document.getElementById('image-zoom-modal').style.display='flex';},
    
    showDefinition(e, contentKey) {
        e.stopPropagation();
        const item = this.state.appConfig.app_content.find(c => c.content_key === contentKey);
        if (item) {
            document.getElementById('definition-title').innerText = item.title;
            document.getElementById('definition-text').innerHTML = item.content_html;
            document.getElementById('definition-modal').style.display = 'block';
        }
    },

    closeModal(){document.getElementById('image-zoom-modal').style.display='none';document.getElementById('definition-modal').style.display='none';document.getElementById('product-modal').style.display='none';},
    populateDateDropdowns(d,m,y){const ds=document.getElementById(d),ms=document.getElementById(m),ys=document.getElementById(y);if(!ds||!ms||!ys)return;if(ys.options.length<=1){const c=new Date().getFullYear();for(let i=c;i>=1920;i--)ys.add(new Option(i,i));}if(ms.options.length<=1){const mo=['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];mo.forEach((m,i)=>ms.add(new Option(m,i+1)));}const ud=()=>{const yv=ys.value,mv=ms.value,dim=(yv&&mv)?new Date(yv,mv,0).getDate():31;const cd=ds.value;ds.innerHTML='<option value="">Dia</option>';for(let i=1;i<=dim;i++)ds.add(new Option(i,i));if(cd)ds.value=cd;};ys.onchange=ud;ms.onchange=ud;ud();},
    toggleContactMethod(){const e=document.getElementById('email-fields'),p=document.getElementById('phone-fields');if(e.classList.contains('hidden')){e.classList.remove('hidden');p.classList.add('hidden');}else{e.classList.add('hidden');p.classList.remove('hidden');}},
    updateProgressBar() {const pbc=document.getElementById('progress-bar-container'),pb=document.getElementById('progress-bar');if(!pbc||!pb)return;const sm={'step0_triage':5,'step1_callusType':15,'step2_location':30,'step3_details':45,'step4_footType':60,'step5_results':75,'step6_investigation':90};const p=sm[this.state.currentStep]||0;if(p>0){pbc.classList.remove('hidden');pb.style.width=`${p}%`;}else{pbc.classList.add('hidden');}},

    showProductModal(category) {
        const productListEl = document.getElementById('product-list');
        const modalTitle = document.getElementById('product-title');
        const products = this.state.appConfig.products.filter(p => p.category === category);
        const userSelected = this.state.diagnosis.userSelectedProducts[category] || [];
        modalTitle.innerText = `Escolha produtos de ${category}`;
        productListEl.innerHTML = products.map(p => `<label class="flex items-center p-3 border rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" name="product-choice" value="${p.name}" ${userSelected.includes(p.name)?'checked':''} class="h-4 w-4 text-blue-600"><div class="ml-3"><p class="font-semibold">${p.name}</p><p class="text-sm text-gray-600">${p.description}</p></div></label>`).join('');
        const confirmButton = document.createElement('button');
        confirmButton.innerText = 'Confirmar Escolha';
        confirmButton.className = 'w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg mt-4';
        confirmButton.onclick = () => { const selected = Array.from(document.querySelectorAll('input[name="product-choice"]:checked')).map(cb => cb.value); this.updateSelectedProducts(category, selected); this.closeModal(); };
        productListEl.appendChild(confirmButton);
        document.getElementById('product-modal').style.display = 'block';
    },

    updateSelectedProducts(category, newProducts) {
        if (!this.state.diagnosis.userSelectedProducts) this.state.diagnosis.userSelectedProducts = {};
        this.state.diagnosis.userSelectedProducts[category] = newProducts;
        this.render();
    },

    generateTreatmentHtml(d, forSaving = false) {
        let fullHtml = ''; let suggestedProducts = new Set();
        const findContent = (key) => this.state.appConfig.app_content.find(c => c.content_key === key);
        
        const parseProductPlaceholders = (text) => {
            if(!text) return '';
            return text.replace(/{products:([^}]+)}/g, (match, cat) => {
                const userSelected = d.userSelectedProducts[cat];
                let productsToShow = [];
                if (userSelected && userSelected.length > 0) { productsToShow = userSelected; } 
                else { const defaultProduct = this.state.appConfig.products.find(p => p.category === cat); if (defaultProduct) productsToShow.push(defaultProduct.name); }
                productsToShow.forEach(p => suggestedProducts.add(p));
                const isUserChoice = userSelected && userSelected.length > 0;
                const textContent = productsToShow.length > 0 ? productsToShow.join(' e ') : `[sugestão de ${cat}]`;
                if (forSaving) return textContent;
                return `<strong class="product-link underline cursor-pointer text-blue-600 ${isUserChoice ? 'user-choice' : ''}" onclick="CallosCareApp.showProductModal('${cat}')">${textContent}</strong>`;
            });
        };

        if (d.painLevel >= 7 || d.inflammation) { const kit = findContent('emergency_kit_protocol'); if(kit) fullHtml += `<div class="p-4 border-l-4 border-red-500 bg-red-50 rounded-lg mb-4 prose max-w-none"><h3 class="text-red-700 font-bold text-center text-lg"><i class="fas fa-exclamation-triangle mr-2"></i>${kit.title}</h3><div class="text-left">${parseProductPlaceholders(kit.content_html)}</div></div>`; }
        
        const callusKey = d.callusType.toLowerCase().replace(/ \/ /g, '_').replace(/ /g, '_').replace(/[()]/g, '') + '_protocol';
        const mainProtocol = findContent(callusKey);
        if(mainProtocol) { const parsedText = parseProductPlaceholders(mainProtocol.content_html); const seeMoreLink = `<span class="text-sm text-blue-600 cursor-pointer hover:underline ml-2" onclick="CallosCareApp.showDefinition(event, '${mainProtocol.content_key}')">(Veja o tratamento completo)</span>`; fullHtml += `<div class="p-4 border-l-4 border-blue-500 bg-blue-50 rounded-lg mb-4 prose max-w-none"><h3 class="font-bold text-center text-lg">${mainProtocol.title.replace('Geral para ', '')} ${seeMoreLink}</h3><div class="text-left">${parsedText}</div></div>`; }

        if (d.hasDeformity) { const deformityInfo = findContent('deformity_info'); if(deformityInfo) { const seeMoreDeformity = `<span class="text-sm text-blue-600 cursor-pointer hover:underline ml-2" onclick="CallosCareApp.showDefinition(event, 'deformity_info')">(veja mais informação)</span>`; fullHtml += `<div class="p-4 border-l-4 border-yellow-500 bg-yellow-50 rounded-lg mb-4 prose max-w-none"><h3 class="font-bold text-center text-lg">Nota sobre Deformidades</h3><div class="text-left"><p>${deformityInfo.content_html} ${seeMoreDeformity}</p></div></div>`; }}
        
        this.state.appConfig.products.forEach(p => { if(d.footType === 'seco' && p.category === 'hidratacao') suggestedProducts.add(p.name); if(d.footType === 'humido' && p.category === 'controlo_humidade') suggestedProducts.add(p.name); if(d.inflammation && p.category === 'inflamacao_dor' && !(d.userSelectedProducts && d.userSelectedProducts['inflamacao_dor'])) suggestedProducts.add(p.name); });
        d.suggestedProducts = Array.from(suggestedProducts);
        
        return { fullHtml };
    },
    
    render() {
        this.updateProgressBar();
        const container = document.getElementById('calloscare-main-content');
        document.getElementById('app-title').innerHTML = `CallosCare <span class="text-sm font-light opacity-75">${this.VERSION}</span>`;
        let content = '';
        const d = this.state.diagnosis;
        switch (this.state.currentStep) {
            case 'loading': content=`<div class="text-center p-8"><i class="fas fa-spinner fa-spin text-4xl text-blue-600"></i></div>`; break;
            case 'error': content=`<div class="text-center p-8 text-red-500">Ocorreu um erro ao carregar. Tente recarregar a página.</div>`; break;
            case 'identification': content=`<div class="max-w-lg mx-auto calloscare-step active"><h2 class="text-2xl font-semibold text-center mb-4">Identificação do Paciente</h2><p class="text-center text-gray-600 mb-6">Para guardar o seu progresso e receber relatórios personalizados, preencha os seus dados.</p><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><input type="text" id="user-first-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Primeiro Nome*"><input type="text" id="user-last-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Último Nome*"></div><div class="grid grid-cols-5 gap-2"><div class="col-span-3"><label class="block text-xs font-medium text-gray-500">Data de Nascimento</label><div class="grid grid-cols-3 gap-1 mt-1"><select id="dob-day" class="block w-full rounded-md border-gray-300 shadow-sm"><option value="">Dia</option></select><select id="dob-month" class="block w-full rounded-md border-gray-300 shadow-sm"><option value="">Mês</option></select><select id="dob-year" class="block w-full rounded-md border-gray-300 shadow-sm"><option value="">Ano</option></select></div></div><div class="col-span-2"><label class="block text-xs font-medium text-gray-500">Sexo</label><select id="user-gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="">N/A</option><option value="Masculino">Masculino</option><option value="Feminino">Feminino</option></select></div></div><div id="email-fields"><div class="space-y-4"><div><input type="email" id="user-email" class="block w-full rounded-md border-gray-300 shadow-sm" placeholder="Email*"></div><div><input type="email" id="user-email-confirm" class="block w-full rounded-md border-gray-300 shadow-sm" placeholder="Confirmar Email*"></div></div><button onclick="CallosCareApp.toggleContactMethod()" class="text-sm text-blue-600 hover:underline mt-2">Prefere usar o telemóvel?</button></div><div id="phone-fields" class="hidden"><div><input type="tel" id="user-phone" class="block w-full rounded-md border-gray-300 shadow-sm" placeholder="Telemóvel*"></div><button onclick="CallosCareApp.toggleContactMethod()" class="text-sm text-blue-600 hover:underline mt-2">Prefere usar o email?</button></div><div class="flex items-start pt-2"><div class="flex items-center h-5"><input id="marketing-consent" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded" checked></div><div class="ml-3 text-sm"><label for="marketing-consent" class="font-medium text-gray-700">Desejo receber gratuitamente mais informação.</label></div></div></div><div class="flex justify-between items-center mt-8"><button onclick="CallosCareApp.startWithoutSaving()" class="text-gray-600 hover:text-gray-800">Iniciar sem guardar</button><button onclick="CallosCareApp.saveUser()" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700">Guardar e Entrar <i id="save-client-spinner" class="fas fa-spinner fa-spin hidden ml-2"></i></button></div><div class="text-center mt-6 border-t pt-4"><button onclick="alert('Funcionalidade de Login será implementada em breve.')" class="text-blue-600 hover:underline">Já tem registo? Aceda ao seu histórico</button></div></div>`; break;
            case 'home': const isGuest = this.state.user.id==='guest'; content=`<div class="max-w-md mx-auto text-center"><h2 class="text-2xl font-semibold mb-2">Bem-vindo(a), ${this.state.user.firstName}!</h2><div class="space-y-4 mt-8"><button onclick="CallosCareApp.startDiagnosis()" class="w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-lg text-lg"><i class="fas fa-plus-circle mr-3"></i> Iniciar Novo Diagnóstico</button><button ${isGuest?'disabled':''} class="w-full bg-gray-600 text-white font-bold py-4 px-6 rounded-lg text-lg ${isGuest?'opacity-50 cursor-not-allowed':''}" onclick="CallosCareApp.viewHistory()"><i class="fas fa-history mr-3"></i> Aceder ao Histórico</button></div>${isGuest?`<div class="mt-8"><button onclick="CallosCareApp.goBackToIdentification()" class="text-gray-600 hover:text-gray-800 underline"><i class="fas fa-arrow-left mr-2"></i> Voltar ao Registo</button></div>`:''}</div>`; break;
            case 'step0_triage': const warning = this.state.appConfig.app_content.find(c => c.content_key === 'diabetes_warning_page'); content = `<h2 class="text-2xl font-semibold text-center mb-6">Pergunta Importante de Segurança</h2><div class="max-w-lg mx-auto space-y-4"><label class="block text-lg font-bold text-gray-700">É diabético ou tem neuropatia/má circulação sanguínea?</label><div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"><button class="calloscare-btn p-4 rounded-lg border-2 border-red-500 text-red-700 hover:bg-red-50" onclick="CallosCareApp.selectOption('is_diabetic',true)">Sim</button><button class="calloscare-btn p-4 rounded-lg border-2 border-green-500 text-green-700 hover:bg-green-50" onclick="CallosCareApp.selectOption('is_diabetic',false); CallosCareApp.goToStep('step1_callusType')">Não</button></div>${d.is_diabetic === true && warning ? `<div class="mt-6">${warning.content_html}</div><div class="flex justify-between mt-8"><button onclick="CallosCareApp.goToStep('home')" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">Voltar</button><button onclick="CallosCareApp.goToStep('step1_callusType')" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">Compreendo, desejo continuar</button></div>` : ''}</div>`; break;
            case 'step1_callusType': const types = this.state.appConfig.callus_types || []; content = `<h2 class="text-2xl font-semibold text-center mb-6">Passo 1: Qual o aspeto da lesão?</h2>${d.is_diabetic ? this.state.appConfig.app_content.find(c=>c.content_key==='diabetes_warning_page').content_html : ''}<div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${types.map(t => `<div class="calloscare-option-card border-2 p-3 text-center rounded-lg flex flex-col justify-between ${d.callusType?.id===t.id?'selected':''}" onclick="this.parentElement.querySelectorAll('.selected').forEach(e=>e.classList.remove('selected'));this.classList.add('selected');CallosCareApp.selectOption('callosType',${JSON.stringify(t).replace(/"/g,"'")})"><img src="${t.image_url}" class="w-full h-32 object-cover rounded-md mb-2" onclick="CallosCareApp.showImageZoom(event,'${t.image_url}')"><div><p class="font-semibold text-blue-600 underline cursor-pointer" onclick="CallosCareApp.showDefinition(event,${t.id})">${t.name}</p><p class="text-xs text-gray-500 mt-1">${t.short_desc}</p></div></div>`).join('')}</div><div class="flex justify-between mt-8"><button onclick="CallosCareApp.goToStep('home')" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">Voltar</button><button onclick="CallosCareApp.goToStep('step2_location')" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg step-next-btn" ${!d.callusType?'disabled':''}>Próximo</button></div>`; break;
            // ... all other steps
        }
        container.innerHTML = content;
        if (this.state.currentStep === 'identification') { this.populateDateDropdowns('dob-day', 'dob-month', 'dob-year'); }
    }
};

document.addEventListener('DOMContentLoaded', () => CallosCareApp.init());
</script>
</body>
</html>
